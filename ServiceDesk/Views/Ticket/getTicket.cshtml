@{
    ViewBag.Title = "getTicket";
    //Layout = "~/Views/Shared/_MasterPage.cshtml";

}
<h2>getTicket</h2>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

@ViewData["Tickets"]

<script>

    //var session = @Html.Raw(ViewData["UserDetails"]);

    var ticket = @Html.Raw(ViewData["Tickets"]);

    var ticketnames = @Html.Raw(ViewData["TicketNames"]);

    var depts = @Html.Raw(ViewData["Depts"]);



    $(document).ready(function () {

        //created by - View for all : C,A,L,M
        document.getElementById('creatorlink').setAttribute('href', '/Role/getEmployee/' + ticket["Emp_ID"]);

        document.getElementById('messagebody').value = ticket["Messagess"];

        // assigned to - View by creator, manager and admin only if is already assigned by team lead
        if (ticket["Assigned_To"] != null) {
            document.getElementById('assignedlink').setAttribute('href', '/Role/getEmployee/' + ticket["Assigned_To"]);
        }else $('#assignedlink').remove();

        //Dept - select dept View to admin and creator else not visible
        if (ticket["Ticket_ID"] == 1) { // should by null or -1 to signify new ticket

            $.each(depts, function (index, element) {
                $('#seldept').append(
                    '<option value="' + element.Dept_ID + '">' + element.Dept_Name + '</option>'
                );
            });
        } else if (false) {// check for creator or admin and hide for lead and assigned to
            $('#seldept').append(
                '<option value="' + ticket.Dept_ID + '">' + ticketnames.Dept_Name + '</option>'
            );
        }

        //Group - select for manager, view to creator and admin, hide for everyone else
        if (true) {

            var groups = @Html.Raw(ViewData["Groups"]);

            $.each(groups, function (index, element) {
                $('#selgrp').append(
                    '<option value="' + element.Group_ID + '">' + element.Group_Name + '</option>'
                );
            });
        } else {}


        // Employee - select for lead view for others
        if (true) {
            var emps = @Html.Raw(ViewData["Emps"]);
            $.each(emps, function (index, element) {
                $('#selemp').append(
                    '<option value="' + element.Emp_ID + '">' + element.Emp_Name + '</option>'
                );
            });
        } else { }

        // Priority - select for manager view for else
        if (true) {
            var prios = ["Low", "Medium", "High"];
            $.each(prios, function (index, element) {
                $('#priority').append(
                    '<option value="' + element + '">' + element + '</option>'
                );
            });
        }

        //Messages
        //$('#messagebody').text = ticket["Messagess"];
        document.getElementById("submessage").onclick = function () { myFunction() };

        function myFunction() {
            var message = $('messagesbox').val();
            ticket["Messagess"] += (" &#10;&#13; " + "Emp name" + ": " + message);
            document.getElementById('messagebody').value = ticket["Messagess"];
        }
        

    });

</script>


<body>


    <a id="creatorlink">View Ticket Creator's Profile</a>
    
    <a id="assignedlink">View Assigned Employee's Profile</a>

    <select id="seldept">
        
    </select>

    <select id="selgrp">

    </select>

    <select id="selemp">

    </select>

    <select id="priority">

    </select>


    <textarea id="messagebody">

    </textarea>

    <input type="text" id="messagesbox" value="Type here"/> <input type="button" id="submessage" value="Send"/>


    <input type="button" id="update details" value="Update Details"/>




</body>




